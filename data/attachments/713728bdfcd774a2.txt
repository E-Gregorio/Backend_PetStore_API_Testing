// PRE-REQUEST SCRIPT:
const getInventoryRequest = {
    url: `${pm.environment.get("baseurl")}/store/inventory`,
    method: 'GET',
    header: {
        'accept': 'application/json'
    }
};

// Usar async/await para asegurar la obtención del inventario antes de ejecutar el test.
async function fetchInventory() {
    try {
        const response = await pm.sendRequest(getInventoryRequest);
        const inventory = response.json();

        if (!inventory || Object.keys(inventory).length === 0) {
            console.error("El inventario está vacío o no se pudo obtener");
            return;
        }

        // Guardar el inventario en una variable de entorno
        pm.environment.set("currentInventory", JSON.stringify(inventory));
        console.log("Inventario guardado:", inventory);

    } catch (error) {
        console.error("Error al obtener el inventario:", error);
    }
}

fetchInventory();
