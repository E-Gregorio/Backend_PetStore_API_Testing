let petId = 123456789; 
pm.environment.set("petId", petId);

pm.sendRequest({
    url: `https://petstore.swagger.io/v2/pet/${petId}`,
    method: 'GET',
    header: {
        'accept': 'application/json'
    }
}, function (err, res) {
    if (err) {
        console.log('Error en la verificación de la mascota:', err);
    } else if (res.status === 404) {
        console.log('Mascota no encontrada, creando una nueva.');
        pm.sendRequest({
            url: `https://petstore.swagger.io/v2/pet`,
            method: 'POST',
            header: {
                'Content-Type': 'application/json'
            },
            body: {
                mode: 'raw',
                raw: JSON.stringify({
                    "id": petId,
                    "category": { "id": 1, "name": "Dogs" },
                    "name": "Buddy",
                    "photoUrls": ["url1", "url2"],
                    "tags": [{ "id": 1, "name": "friendly" }],
                    "status": "available"
                })
            }
        }, function (createErr, createRes) {
            if (createErr) {
                console.log('Error al crear la mascota:', createErr);
            } else {
                console.log('Mascota creada con éxito:', createRes.status);
            }
        });
    }
});
